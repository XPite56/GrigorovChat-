<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¢–µ—Å—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
    <style>
        body { background: #13132b; color: white; font-family: sans-serif; text-align: center; padding: 50px; }
        .box { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 20px; border: 1px solid #6c5ce7; max-width: 300px; margin: auto; }
        #push { 
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: #6c5ce7; padding: 15px 30px; border-radius: 50px;
            transition: 0.5s; box-shadow: 0 0 20px #6c5ce7;
        }
        #push.active { top: 20px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 10px; border: none; }
        button { background: #6c5ce7; color: white; cursor: pointer; }
    </style>
</head>
<body>

    <div id="push">üîî –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</div>

    <div class="box">
        <h3>Notification Test</h3>
        <p id="status">–°—Ç–∞—Ç—É—Å: –í—ã–∫–ª—é—á–µ–Ω–æ</p>
        <button onclick="start()">1. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ—Å–ª—É—à–∫—É</button>
        <hr>
        <input type="text" id="target" placeholder="–ö–æ–º—É (Email)">
        <button onclick="send()">2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¢–µ—Å—Ç</button>
    </div>

<script>
    const client = new Appwrite.Client()
        .setEndpoint('https://cloud.appwrite.io/v1')
        .setProject('695824a900049124f435');
    const db = new Appwrite.Databases(client);
    const D_ID = '695825270032517f8888', C_MSGS = 'messages';

    // –í–ê–ñ–ù–û: –ü–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ—é –ø–æ—á—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∞
    const MY_EMAIL = 'daniilgrigorov26@gmail.com'; 

    function start() {
        document.getElementById('status').innerText = "–°—Ç–∞—Ç—É—Å: –°–ª—É—à–∞—é –±–∞–∑—É...";
        
        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Realtime
        client.subscribe(`databases.${D_ID}.collections.${C_MSGS}.documents`, res => {
            console.log("–ü—Ä–∏—à–ª–æ —Å–æ–±—ã—Ç–∏–µ:", res);
            const m = res.payload;
            
            // –ï—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å - —è
            if(m.receiver === MY_EMAIL) {
                const el = document.getElementById('push');
                el.innerText = "üì© –û—Ç: " + m.sender + " | " + m.text;
                el.classList.add('active');
                setTimeout(() => el.classList.remove('active'), 4000);
            }
        });
        alert("–ü—Ä–æ—Å–ª—É—à–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π –≤–∫–ª–∞–¥–∫—É.");
    }

    async function send() {
        const to = document.getElementById('target').value;
        try {
            await db.createDocument(D_ID, C_MSGS, 'unique()', {
                text: "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏! " + new Date().toLocaleTimeString(),
                sender: "TESTER",
                receiver: to
            });
            alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!");
        } catch(e) {
            alert("–û—à–∏–±–∫–∞: " + e.message + " | –ü—Ä–æ–≤–µ—Ä—å Permissions –≤ Appwrite Console!");
        }
    }
</script>
</body>
</html>
